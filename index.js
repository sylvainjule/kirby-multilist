(function(){"use strict";function d(s,t,i,e,n,a,l,o){var r=typeof s=="function"?s.options:s;return t&&(r.render=t,r.staticRenderFns=i,r._compiled=!0),{exports:s,options:r}}const u={extends:"k-structure-field",data(){return{needsItemsSync:!1,skipSort:!1}},methods:{add(s=null){if(this.more===!1)return!1;s=s??this.$helper.field.form(this.fields),s._id=s._id??this.$helper.uuid(),this.prepend===!0?this.items.unshift(s):this.items.push(s),this.save(),this.setFocus(s)},onTableInput(s){var t=Object.values(s).map((i,e)=>{const n=this.items[e];return{...i,_id:i._id||n&&n._id||this.$helper.uuid()}});this.value=t,this.limit&&(t=this.items.toSpliced(this.pagination.offset,this.limit,...t)),this.needsItemsSync=!0,this.save(t)},open(s,t,i=!1){this.needsItemsSync&&(this.items=this.toItems(this.value),this.needsItemsSync=!1);const e=this.findIndex(s);if(this.disabled===!0||e===-1)return!1;this.$panel.drawer.open({component:"k-structure-drawer",id:this.id,props:{icon:this.icon??"list-bullet",next:this.items[e+1],prev:this.items[e-1],tabs:{content:{fields:this.form(t)}},title:this.label,value:s},replace:i,on:{input:n=>{const a=this.findIndex(s);this.$panel.drawer.props.next=this.items[a+1],this.$panel.drawer.props.prev=this.items[a-1],this.$set(this.items,a,n),this.save()},next:()=>{this.navigate(s,1)},prev:()=>{this.navigate(s,-1)},remove:()=>{this.remove(s)}}})},save(s=this.items){this.skipSort=!0,this.$emit("input",s),this.$nextTick(()=>{this.skipSort=!1})},setFocus(s){let t=s._id;this.$nextTick(()=>{this.$refs["multilist-table"].$el.querySelector('[data-id="'+t+'"] input').focus()})},toItems(s){return Array.isArray(s)===!1?[]:(s=s.map(t=>({_id:t._id??this.$helper.uuid(),...t})),this.skipSort?s:this.sort(s))}}};var c=function(){var t=this,i=t._self._c;return i("k-field",t._b({staticClass:"k-structure-field",nativeOn:{click:function(e){e.stopPropagation()}},scopedSlots:t._u([t.hasFields&&!t.disabled?{key:"options",fn:function(){return[i("k-button-group",{attrs:{layout:"collapsed"}},[i("k-button",{attrs:{autofocus:t.autofocus,disabled:!t.more,responsive:!0,text:t.$t("add"),icon:"add",variant:"filled",size:"xs"},on:{click:function(e){return t.add()}}}),i("k-button",{attrs:{icon:"dots",size:"xs",variant:"filled"},on:{click:function(e){return t.$refs.options.toggle()}}}),i("k-dropdown-content",{ref:"options",attrs:{options:[{click:()=>t.add(),disabled:!t.more,icon:"add",text:t.$t("add")},{click:()=>t.removeAll(),disabled:t.items.length===0||t.disabled,icon:"trash",text:t.$t("delete.all")}],"align-x":"end"}})],1)]},proxy:!0}:null],null,!0)},"k-field",t.$props,!1),[i("k-input-validator",t._b({attrs:{value:JSON.stringify(t.items)}},"k-input-validator",{min:t.min,max:t.max,required:t.required},!1),[t.hasFields?[t.items.length===0?i("k-empty",{attrs:{icon:"list-bullet"},on:{click:function(e){return t.add()}}},[t._v(" "+t._s(t.empty??t.$t("field.structure.empty"))+" ")]):[i("k-multilist-table",{ref:"multilist-table",attrs:{columns:t.columns,disabled:t.disabled,fields:t.fields,empty:t.$t("field.structure.empty"),index:t.index,options:t.options,pagination:t.limit?t.pagination:!1,rows:t.paginatedItems,sortable:t.isSortable,value:t.paginatedItems},on:{cell:function(e){return t.open(e.row,e.columnIndex)},input:t.onTableInput,option:t.option,paginate:t.paginate}}),t.more?i("footer",[i("k-button",{attrs:{title:t.$t("add"),icon:"add",size:"xs",variant:"filled"},on:{click:function(e){return t.add()}}})],1):t._e()]]:[i("k-empty",{attrs:{icon:"list-bullet"}},[t._v(t._s(t.$t("fields.empty")))])]],2)],1)},p=[],f=d(u,c,p);const h=f.exports,b={extends:"k-table",props:{value:Object},methods:{hasFieldType(s){return this.$helper.isComponent("k-"+s+"-field")}}};var m=function(){var t=this,i=t._self._c;return i("div",{class:["k-table","k-multilist-table",t.$attrs.class],style:t.$attrs.style,attrs:{"aria-disabled":t.disabled}},[i("table",{attrs:{"data-disabled":t.disabled,"data-indexed":t.hasIndexColumn,"data-selecting":t.selecting}},[i("thead",[i("tr",[t.hasIndexColumn?i("th",{staticClass:"k-table-index-column",attrs:{"data-mobile":"true"}},[t._v("#")]):t._e(),t._l(t.columns,function(e,n){return i("th",{key:n+"-header",staticClass:"k-table-column",style:{width:t.width(e.width)},attrs:{"data-align":e.align,"data-column-id":n,"data-mobile":e.mobile},on:{click:function(a){return t.onHeader({column:e,columnIndex:n})}}},[t._t("header",function(){return[t._v(" "+t._s(t.label(e,n))+" ")]},null,{column:e,columnIndex:n,label:t.label(e,n)})],2)}),t.hasOptions?i("th",{staticClass:"k-table-options-column",attrs:{"data-mobile":"true"}}):t._e()],2)]),i("k-draggable",{attrs:{list:t.values,options:t.dragOptions,handle:!0,element:"tbody"},on:{change:t.onChange,end:t.onSort}},[t.rows.length===0?i("tr",[i("td",{staticClass:"k-table-empty",attrs:{colspan:t.colspan}},[t._v(" "+t._s(t.empty)+" ")])]):t._l(t.values,function(e,n){return i("tr",{key:e.id??e._id??e.value??JSON.stringify(e),class:{"k-table-sortable-row":t.rowIsSortable(e)},attrs:{"data-id":e.id??e._id??e.value??JSON.stringify(e),"data-selecting":t.selecting,"data-selectable":t.rowIsSelectable(e),"data-sortable":t.rowIsSortable(e)}},[t.hasIndexColumn?i("td",{staticClass:"k-table-index-column",attrs:{"data-mobile":"true"}},[t._t("index",function(){return[i("div",{staticClass:"k-table-index",domProps:{textContent:t._s(t.index+n)}})]},null,{row:e,rowIndex:n}),t.rowIsSortable(e)?i("k-sort-handle",{staticClass:"k-table-sort-handle"}):t._e()],2):t._e(),t._l(t.columns,function(a,l){return i("td",{key:l,staticClass:"k-multilist-field-column",style:{width:t.width(a.width)},attrs:{id:l,mobile:a.mobile,"data-mobile":a.mobile}},[t.hasFieldType(t.fields[l].type)?i("k-"+t.fields[l].type+"-field",t._b({ref:"list-"+t.fields[l].name+"-"+n,refInFor:!0,tag:"component",attrs:{name:l,novalidate:t.novalidate,disabled:t.disabled,label:!1},on:{input:function(o){return t.$emit("input",t.value)},keydown:function(o){return!o.type.indexOf("key")&&t._k(o.keyCode,"enter",13,o.key,"Enter")||!o.shiftKey?null:(o.preventDefault(),t.addItem.apply(null,arguments))},keyup:function(o){return t.onKeyup(t.index,l,t.fields[l],o)}},model:{value:t.value[n][l],callback:function(o){t.$set(t.value[n],l,o)},expression:"value[rowIndex][columnName]"}},"component",t.fields[l],!1)):t._e()],1)}),t.hasOptions?i("td",{staticClass:"k-table-options-column",attrs:{"data-mobile":"true"}},[t.selecting?[i("label",{staticClass:"k-table-select-checkbox"},[i("input",{attrs:{disabled:e.selectable===!1,type:"checkbox"},on:{change:function(a){return t.$emit("select",e,n)}}})])]:[t._t("options",function(){return[i("k-options-dropdown",{attrs:{options:e.options??t.options,text:(e.options??t.options).length>1},on:{option:function(a){return t.onOption(a,e,n)}}})]},null,{row:e,rowIndex:n})]],2):t._e()],2)})],2)],1),t.pagination?i("k-pagination",t._b({staticClass:"k-table-pagination",on:{paginate:function(e){return t.$emit("paginate",e)}}},"k-pagination",t.pagination,!1)):t._e()],1)},_=[],k=d(b,m,_);const v=k.exports;panel.plugin("sylvainjule/multilist",{fields:{multilist:h},components:{"k-multilist-table":v}})})();
